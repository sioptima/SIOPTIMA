// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
  engineType = "client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                Int             @id @default(autoincrement())
  username          String          @unique
  password          String
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  deletedAt         DateTime?

  role              Role            @relation(fields: [roleId], references: [id])
  roleId            Int

  profile           Profile?

  sites             Site[]

  shift             JadwalShift[]

  presensi          Presensi[]      @relation("holder")

  checkOut          CheckOut[]

  approved          Presensi[]      @relation("approver")

  laporan           Laporan[]

  ijin              Ijin[]

  libur             Libur[]

  help              Help[]

  ticket            Ticket[]
}

enum RoleName {
  ADMIN
  OPERATOR
  HRD
}

model Role {
  id                Int             @id @default(autoincrement())
  name              RoleName        @unique
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  deletedAt         DateTime?

  users             User[]
}

model JadwalShift {
  id                Int             @id @default(autoincrement())
  shiftDate         DateTime
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  deletedAt         DateTime?

  user              User            @relation(fields: [userId], references: [id])
  userId            Int

  site              Site            @relation(fields: [siteId], references: [id])
  siteId            Int

  presensi          Presensi?
}

enum SiteStatus {
  ACTIVE
  MAINTENANCE
  INACTIVE
}

model Site {
  id                Int             @id @default(autoincrement())
  name              String          @unique
  image             String?
  status            SiteStatus      @default(ACTIVE)
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  deletedAt         DateTime?

  address           SiteAddress     @relation(fields: [addressId], references: [id])
  addressId         Int             @unique

  users             User[]

  report            Laporan[]

  shift             JadwalShift[]
}

model SiteAddress {
  id                Int             @id @default(autoincrement())
  address           String
  city              String
  province          String
  latitude          Float
  longitude         Float
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  deletedAt         DateTime?

  site              Site?
}

model Profile {
  id                Int             @id @default(autoincrement())
  birthDate         DateTime
  image             String?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  deletedAt         DateTime?

  user              User            @relation(fields: [userId], references: [id])
  userId            Int             @unique

  address           UserAddress?
}

model UserAddress {
  id                Int             @id @default(autoincrement())
  address           String
  city              String
  province          String
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  deletedAt         DateTime?

  profile           Profile         @relation(fields: [profileId], references: [id])
  profileId         Int             @unique
}

enum StatusApproval { //multiple table depends on this
  APPROVED
  PENDING
  REJECTED
}

enum StatusPresensi {
  ONTIME
  LATE
}

model Presensi {
  id                Int             @id @default(autoincrement())
  presensiDate      DateTime
  latitude          Float             
  longitude         Float
  fotoDiri          String?
  statusPresensi    StatusPresensi
  statusApproval    StatusApproval  @default(PENDING)
  approvedAt        DateTime?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  deletedAt         DateTime?

  shift             JadwalShift?    @relation(fields: [shiftid], references: [id])
  shiftid           Int?            @unique 

  user              User            @relation(fields: [userId], references: [id], name: "holder")
  userId            Int

  approver          User?           @relation(fields: [approverId], references: [id], name: "approver")   
  approverId        Int?

  checkOut          CheckOut?
}

model CheckOut {
  id                Int             @id @default(autoincrement())
  checkOutDate      DateTime
  latitude          Float             
  longitude         Float
  fotoDiri          String?
  approvedAt        DateTime?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  deletedAt         DateTime?


  user              User            @relation(fields: [userId], references: [id])
  userId            Int

  checkIn           Presensi        @relation(fields: [checkInId], references: [id])
  checkInId         Int             @unique
}

enum EquipmentStatus {
  NORMAL
  MAINTENANCE
  BROKEN
}

model Laporan {
  id                Int             @id @default(autoincrement())
  fotoSampel        String[]
  flowRate          Float
  volt              Float
  pH                Float
  ampere            Float
  TDS               Float
  EC                Float
  laporanStatus     StatusApproval  @default(PENDING)
  agitatorStatus    EquipmentStatus @default(NORMAL)
  settleStatus      EquipmentStatus @default(NORMAL)
  outFilterStatus   EquipmentStatus @default(NORMAL)
  notes             String          @db.Text
  laporanDate       DateTime        @default(now())  
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  deletedAt         DateTime?
  
  site              Site            @relation(fields: [siteName], references: [name])
  siteName          String

  user              User            @relation(fields: [userId], references: [id])
  userId            Int
}

model Ijin {
  id                Int             @id @default(autoincrement())
  ijinDate          DateTime        @default(now())
  ijinStatus        StatusApproval  @default(PENDING)
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  deletedAt         DateTime?

  user              User            @relation(fields: [userId], references: [id])
  userId            Int
}

model Libur {
  id                Int             @id @default(autoincrement())
  liburDate         DateTime        
  liburStatus       StatusApproval  @default(PENDING)
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  deletedAt         DateTime?

  user              User            @relation(fields: [userId], references: [id])
  userId            Int
}

model Help {
  id                Int             @id @default(autoincrement())
  deskripsi         String          @db.Text       
  gambar            String?
  helpDate          DateTime        @default(now())
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  deletedAt         DateTime?

  user              User            @relation(fields: [userId], references: [id])
  userId            Int
}

model Ticket {
  id                Int             @id @default(autoincrement())
  deskripsi         String          @db.Text
  gambar            String?
  ticketDate        DateTime
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  deletedAt         DateTime?

  user              User            @relation(fields: [userId], references: [id])
  userId            Int
}